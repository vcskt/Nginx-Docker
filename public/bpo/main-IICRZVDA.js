import{a as F,b as J,c as P,d as f,e as V}from"./chunk-6COOJ4IH.js";import{Fa as U,Ga as H,Ha as j,Ia as D,Ja as K,La as q,Ma as $,Pa as z,c as N,f as T,g as c,j as R,ja as k,l as C,m as w,n as x,o as y,p as M,r as L,s as u,u as O}from"./chunk-OPSSS4EV.js";import{Cb as p,Ib as a,Jb as s,Kb as l,Tb as I,Ub as A,bb as m,bc as b,cb as r,na as S,ob as g,tc as _,ub as h,vc as E}from"./chunk-FMFEBW5D.js";var d=class t{constructor(o,e,i,n){this.router=o;this.http=e;this.poNotification=i;this.proAppConfigService=n;this.proAppConfigService.insideProtheus()?(sessionStorage.setItem("insideProtheus","1"),this.router.navigate(["/aprovacao-titulos"])):(this.proAppConfigService.loadAppConfig(),sessionStorage.setItem("insideProtheus","0"))}loading=!1;username="";ngOnInit(){sessionStorage.getItem("ERPTOKEN")&&this.router.navigate(["/aprovacao-titulos"])}getHttpOptions(){let o=sessionStorage.getItem("ERPTOKEN");if(!o)return console.warn("Token n\xE3o encontrado!"),this.poNotification.error("Sess\xE3o expirada. Por favor, fa\xE7a login novamente."),this.router.navigate(["/login"]),{headers:new c};try{let e=JSON.parse(o);return{headers:new c().set("Content-Type","application/json").set("Authorization",`Bearer ${e.access_token}`)}}catch(e){return console.error("Erro ao processar token:",e),this.poNotification.error("Erro na autentica\xE7\xE3o. Por favor, fa\xE7a login novamente."),this.router.navigate(["/login"]),{headers:new c}}}onLoginSubmit(o){this.loading=!0,this.username=o.login;let e=`${P.apiUrl}/api/oauth2/v1/token?grant_type=password&username=${encodeURIComponent(o.login)}&password=${encodeURIComponent(o.password)}`,i=new c({"Content-Type":"application/json"});console.log("[API][Login] Iniciando requisi\xE7\xE3o de login:",{url:e,username:o.login}),this.http.post(e,{},{headers:i}).subscribe({next:n=>{console.log("[API][Login] Resposta recebida:",n),n&&n.access_token?(sessionStorage.setItem("ERPTOKEN",JSON.stringify(n)),this.validateUserAccess(this.username)):(this.loading=!1,this.poNotification.error("Usu\xE1rio ou senha inv\xE1lidos."))},error:n=>{this.loading=!1,console.error("[API][Login] Erro na requisi\xE7\xE3o:",n),this.poNotification.error("Erro ao realizar login. Verifique suas credenciais.")}})}validateUserAccess(o){let e=`${P.apiUrl}/FCWS0101/get_id?id=${encodeURIComponent(o)}`;console.log("[API][validateUserAccess] Iniciando requisi\xE7\xE3o:",{url:e,username:o}),this.http.get(e,this.getHttpOptions()).subscribe({next:i=>{this.loading=!1,console.log("[API][validateUserAccess] Resposta recebida:",i),i&&i.descri?(this.poNotification.success("Login realizado com sucesso!"),this.router.navigate(["/aprovacao-titulos"])):(this.poNotification.error("Usu\xE1rio sem acesso ao sistema."),sessionStorage.removeItem("ERPTOKEN"))},error:i=>{this.loading=!1,console.error("[API][validateUserAccess] Erro na requisi\xE7\xE3o:",i),i.status===401?(this.poNotification.error("Sess\xE3o expirada. Por favor, fa\xE7a login novamente."),sessionStorage.removeItem("ERPTOKEN"),this.router.navigate(["/login"])):(this.poNotification.error("Usu\xE1rio sem acesso ao sistema."),sessionStorage.removeItem("ERPTOKEN"))}})}static \u0275fac=function(e){return new(e||t)(r(u),r(R),r(k),r(f))};static \u0275cmp=g({type:t,selectors:[["app-login"]],decls:2,vars:1,consts:[[1,"login-container"],["p-product-name","Portal de Aprova\xE7\xE3o","p-logo","assets/images/vivest.svg",3,"p-login-submit","p-loading"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"po-page-login",1),I("p-login-submit",function(Z){return i.onLoginSubmit(Z)}),s()()),e&2&&(m(),p("p-loading",i.loading))},dependencies:[J,F],styles:[".login-container[_ngcontent-%COMP%]{position:relative;height:100vh;width:100vw}"]})};var W=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:d},{path:"sobre",loadComponent:()=>import("./chunk-CQ2BHGVA.js").then(t=>t.SobreComponent)},{path:"aprovacao-titulos",loadComponent:()=>import("./chunk-RXJFGONX.js").then(t=>t.AprovacaoTitulosComponent)},{path:"visualizar-importacao/:codImportacao",loadComponent:()=>import("./chunk-3OTJHOYO.js").then(t=>t.VisualizarImportacaoComponent)},{path:"**",redirectTo:"login"}];var B={providers:[O(W),C(),S([z]),E({eventCoalescing:!0}),C(w())]};function oe(t,o){t&1&&(a(0,"div",5),l(1,"img",6),s())}function te(t,o){if(t&1&&(a(0,"div",2),l(1,"po-toolbar"),a(2,"po-menu",3),h(3,oe,2,0,"div",4),s(),a(4,"po-page-default"),l(5,"router-outlet"),s()()),t&2){let e=A();m(2),p("p-collapsed",!0)("p-filter",!0)("p-menus",e.menus)("p-automatic-toggle",!1)}}function ie(t,o){t&1&&l(0,"router-outlet")}var v=class t{constructor(o,e){this.router=o;this.proAppConfigService=e;this.router.events.subscribe(i=>{i instanceof M&&(this.showMenu=!i.urlAfterRedirects.startsWith("/login"))})}showMenu=!0;menus=[{label:"Aprova\xE7\xE3o de Titulos",action:this.browseClick.bind(this),icon:"po-icon-finance",shortLabel:"Cadastro"},{label:"Sobre",action:this.aboutClick.bind(this),icon:"po-icon-info",shortLabel:"Sobre"},{label:"Sair",action:this.closeApp.bind(this),icon:"po-icon-exit",shortLabel:"Sair"}];aboutClick(){this.router.navigate(["/","sobre"])}browseClick(){let o=localStorage.getItem("access_token"),e=localStorage.getItem("expires_at");o&&e&&Date.now()<Number(e)?this.router.navigate(["/aprovacao-titulos"]):(localStorage.removeItem("access_token"),localStorage.removeItem("expires_at"),this.router.navigate(["/login"]))}closeApp(){this.proAppConfigService.insideProtheus()?this.proAppConfigService.callAppClose():(sessionStorage.removeItem("ERPTOKEN"),sessionStorage.removeItem("insideProtheus"),this.router.navigate(["/login"]).then(()=>{window.location.reload()}))}static \u0275fac=function(e){return new(e||t)(r(u),r(f))};static \u0275cmp=g({type:t,selectors:[["app-root"]],decls:3,vars:2,consts:[["loginOnly",""],["class","po-wrapper",4,"ngIf","ngIfElse"],[1,"po-wrapper"],[3,"p-collapsed","p-filter","p-menus","p-automatic-toggle"],["class","po-p-2 po-flex po-justify-center",4,"p-menu-header-template"],[1,"po-p-2","po-flex","po-justify-center"],["src","assets/images/vivest.svg","alt","Logo",2,"max-width","120px","max-height","60px"]],template:function(e,i){if(e&1&&h(0,te,6,4,"div",1)(1,ie,1,0,"ng-template",null,0,_),e&2){let n=b(2);p("ngIf",i.showMenu)("ngIfElse",n)}},dependencies:[T,N,L,$,q,j,H,U,K,D,x,V],encapsulation:2})};y(v,B).catch(t=>console.error(t));
