import{c as M,d as ue}from"./chunk-6COOJ4IH.js";import{$ as j,Aa as ce,B as U,C as Y,D as G,E as V,H as X,Na as de,Oa as me,aa as Z,b as H,ba as ee,c as O,ca as oe,da as te,f as N,g as S,j as J,ja as ie,ka as ae,la as re,na as ne,oa as se,qa as pe,s as K,ta as k,w as x,xa as le,ya as F,z as D}from"./chunk-OPSSS4EV.js";import{$b as A,Cb as u,Ib as p,Jb as s,Kb as $,Nb as W,Ob as I,Tb as C,_b as w,a as z,ac as P,b as B,bb as l,cb as _,cc as g,dc as L,fc as Q,gc as h,hc as v,ic as f,lc as q,ob as E,sa as c,ta as d,ub as y,za as R}from"./chunk-FMFEBW5D.js";var _e=["modal"],ye=m=>({label:"Confirmar",action:m}),we=m=>({label:"Cancelar",action:m});function Ae(m,o){m&1&&(p(0,"div",5),g(1,"Observa\xE7\xE3o \xE9 obrigat\xF3ria."),s())}var T=class m{modal;observacao="";confirm=new R;cancel=new R;erro=!1;open(){this.observacao="",this.erro=!1,this.modal.open()}close(){this.erro=!1,this.modal.close()}onConfirm(){if(!this.observacao.trim()){this.erro=!0;return}this.confirm.emit(this.observacao),this.close()}onCancel(){this.cancel.emit(),this.close()}static \u0275fac=function(i){return new(i||m)};static \u0275cmp=E({type:m,selectors:[["app-aprovacao-observacao-modal"]],viewQuery:function(i,e){if(i&1&&w(_e,7),i&2){let r;A(r=P())&&(e.modal=r.first)}},outputs:{confirm:"confirm",cancel:"cancel"},decls:5,vars:8,consts:[["modal",""],["p-title","Observa\xE7\xE3o",3,"p-primary-action","p-secondary-action"],[2,"margin-bottom","16px"],["name","observacao","p-label","Observa\xE7\xE3o","p-required","","p-placeholder","Digite o motivo da aprova\xE7\xE3o/reprova\xE7\xE3o","p-autofocus","",3,"ngModelChange","ngModel"],["style","color: #c00; font-size: 13px; margin-top: 4px;",4,"ngIf"],[2,"color","#c00","font-size","13px","margin-top","4px"]],template:function(i,e){if(i&1){let r=I();p(0,"po-modal",1,0)(2,"div",2)(3,"po-input",3),f("ngModelChange",function(t){return c(r),v(e.observacao,t)||(e.observacao=t),d(t)}),s(),y(4,Ae,2,0,"div",4),s()()}i&2&&(u("p-primary-action",q(4,ye,e.onConfirm.bind(e)))("p-secondary-action",q(6,we,e.onCancel.bind(e))),l(3),h("ngModel",e.observacao),l(),u("ngIf",e.erro))},dependencies:[N,O,V,x,D,te,oe,F,k],encapsulation:2})};var Pe=["tableRef"];function Se(m,o){m&1&&W(0)}function Me(m,o){m&1&&W(0)}function Te(m,o){if(m&1&&(p(0,"div",3)(1,"po-widget",27)(2,"div",28),g(3),s()(),y(4,Se,1,0,"ng-container",29)(5,Me,1,0,"ng-container",29),s()),m&2){let i=o.$implicit;l(),u("p-title",i.title),l(2),L(i.value),l(),u("ngIf",i.title==="APROVADAS"),l(),u("ngIf",i.title==="REPROVADAS")}}var ge=class m{constructor(o,i,e,r){this.http=o;this.poNotification=i;this.router=e;this.proAppConfigService=r;let a=new Date,t=new Date(a.getFullYear(),a.getMonth(),1);this.dataInicial=this.formatDate(t),this.dataFinal=this.formatDate(a),this.loadCards(),this.actions=[{label:"Visualizar",action:this.onView.bind(this)}]}actions=[];dataInicial="";dataFinal="";cards=[{title:"MINHAS PEND\xCANCIAS",value:0,selected:!0},{title:"APROVADAS",value:0,selected:!1},{title:"REPROVADAS",value:0,selected:!1}];exibirOpcao="pendentes";caprov="P";get exibirPendentes(){return this.exibirOpcao==="pendentes"}set exibirPendentes(o){o&&(this.exibirOpcao="pendentes",this.caprov="P",this.loadTableData())}get exibirAprovados(){return this.exibirOpcao==="aprovados"}set exibirAprovados(o){o&&(this.exibirOpcao="aprovados",this.caprov="A",this.loadTableData())}get exibirReprovados(){return this.exibirOpcao==="reprovados"}set exibirReprovados(o){o&&(this.exibirOpcao="reprovados",this.caprov="R",this.loadTableData())}primary=j.Primary||"primary";danger=j.Danger||"danger";columns=[{property:"codigo",label:"Cod. Importa\xE7\xE3o"},{property:"tipo",label:"Tipo"},{property:"dataFormatada",label:"Data"},{property:"hora",label:"Hora"},{property:"valor",label:"Valor Total"},{property:"user",label:"Usu\xE1rio"},{property:"arquivo",label:"Arquivo",width:"180px"}];items=[];modalAcao=null;observacaoRecebida="";modalObs;selectedItems=[];tableRef;page=1;pageSize=5;searchText="";filteredItems=[];get pagedItems(){let o=(this.page-1)*this.pageSize;return this.filteredItems.slice(o,o+this.pageSize)}get totalPages(){return Math.ceil(this.items.length/this.pageSize)||1}ngOnInit(){let o=sessionStorage.getItem("ERPTOKEN"),i=this.proAppConfigService&&this.proAppConfigService.insideProtheus&&this.proAppConfigService.insideProtheus();if(!o&&!i){this.router.navigate(["/login"]);return}this.loadTableData(),this.filteredItems=this.items}formatDate(o){let i=o.getFullYear(),e=String(o.getMonth()+1).padStart(2,"0"),r=String(o.getDate()).padStart(2,"0");return`${i}-${e}-${r}`}getApiDate(o){return o.replace(/-/g,"")}formatDateBr(o){if(!o)return"";if(/^\d{4}[-/]\d{2}[-/]\d{2}$/.test(o)){let[i,e,r]=o.split(/[-/]/);return`${r}/${e}/${i}`}return/^\d{8}$/.test(o)?`${o.substring(6,8)}/${o.substring(4,6)}/${o.substring(0,4)}`:o}loadCards(){let o=this.getApiDate(this.dataInicial),i=this.getApiDate(this.dataFinal),e=`${M.apiUrl}/FCWS0102/get_all?dtini=${o}&dtfim=${i}`,r=sessionStorage.getItem("ERPTOKEN"),a=this.proAppConfigService&&this.proAppConfigService.insideProtheus&&this.proAppConfigService.insideProtheus(),t={};if(r)try{let n=JSON.parse(r);t={headers:new S().set("Content-Type","application/json").set("Authorization",`Bearer ${n.access_token}`)}}catch(n){console.error("Erro ao processar token:",n),this.poNotification.error("Erro na autentica\xE7\xE3o. Por favor, fa\xE7a login novamente."),this.router.navigate(["/login"]);return}if(!r&&!a){this.poNotification.error("Sess\xE3o expirada. Fa\xE7a login novamente."),this.router.navigate(["/login"]);return}console.log("[API][loadCards] Iniciando requisi\xE7\xE3o:",{url:e,dtini:o,dtfim:i,options:t}),this.http.get(e,t).subscribe({next:n=>{if(console.log("[API][loadCards] Resposta recebida:",n),n&&Array.isArray(n.objects)){this.cards[0].value=0,this.cards[1].value=0,this.cards[2].value=0;for(let b of n.objects)b.status==="3"&&(this.cards[0].value=b.qtd),b.status==="5"&&(this.cards[1].value=b.qtd),b.status==="4"&&(this.cards[2].value=b.qtd)}},error:n=>{console.error("[API][loadCards] Erro na requisi\xE7\xE3o:",n),n.status===401&&a?this.poNotification.warning("N\xE3o foi poss\xEDvel carregar os dados. Tente novamente mais tarde."):this.poNotification.error("Erro ao buscar dados do painel.")}})}onPesquisar(){this.loadCards(),this.loadTableData()}onView(o){this.router.navigate(["/visualizar-importacao",o.codigo],{state:{codigo:o.codigo,arquivo:o.arquivo,tipo:o.tipo,data:o.dataFormatada,hora:o.hora,valor:o.valor,usuario:o.user}})}onSearchChange(){let o=this.searchText?this.searchText.toLowerCase():"";o?this.filteredItems=this.items.filter(i=>Object.values(i).some(e=>e&&e.toString().toLowerCase().includes(o))):this.filteredItems=this.items}loadTableData(){let o=this.getApiDate(this.dataInicial),i=this.getApiDate(this.dataFinal),e=`${M.apiUrl}/FCWS0103/get_all?dtini=${o}&dtfim=${i}&caprov=${this.caprov}`,r=sessionStorage.getItem("ERPTOKEN"),a=this.proAppConfigService&&this.proAppConfigService.insideProtheus&&this.proAppConfigService.insideProtheus(),t={};if(r)try{let n=JSON.parse(r);t={headers:new S().set("Content-Type","application/json").set("Authorization",`Bearer ${n.access_token}`)}}catch(n){console.error("Erro ao processar token:",n),this.poNotification.error("Erro na autentica\xE7\xE3o. Por favor, fa\xE7a login novamente."),this.router.navigate(["/login"]);return}if(!r&&!a){this.poNotification.error("Sess\xE3o expirada. Fa\xE7a login novamente."),this.items=[],this.filteredItems=[],this.router.navigate(["/login"]);return}this.http.get(e,t).subscribe({next:n=>{if(n&&n.errorId&&n.error){this.items=[],this.filteredItems=[],n.errorId==="ID003"?this.poNotification.information("N\xE3o encontramos registros para o per\xEDodo selecionado. Por favor, tente ajustar as datas de pesquisa."):this.poNotification.information("Nenhum dado encontrado para os filtros selecionados.");return}this.items=(n.objects||[]).map(b=>B(z({},b),{dataFormatada:this.formatDateBr(b.data)})),this.filteredItems=this.items,this.items.length===0&&this.poNotification.information("N\xE3o h\xE1 dados para exibir.")},error:n=>{n.status===404?this.poNotification.information("N\xE3o h\xE1 dados para exibir."):n.status===401&&a?this.poNotification.warning("N\xE3o foi poss\xEDvel carregar os dados. Tente novamente mais tarde."):n.status===401&&!a?(this.poNotification.error("Sess\xE3o expirada ou sem permiss\xE3o. Fa\xE7a login novamente."),this.router.navigate(["/login"])):n.error&&n.error.errorId==="ID003"?this.poNotification.information("N\xE3o encontramos registros para o per\xEDodo selecionado. Por favor, tente ajustar as datas de pesquisa."):this.poNotification.error("Erro ao buscar dados da tabela."),n.status===401&&a||(this.items=[],this.filteredItems=[])}})}abrirModalAcao(o){let i=this.tableRef&&this.tableRef.getSelectedRows?this.tableRef.getSelectedRows():[];if(!i||i.length===0){this.poNotification.warning("Selecione pelo menos um item da tabela para continuar.");return}this.selectedItems=i,this.modalAcao=o,this.modalObs&&this.modalObs.open()}onConfirmObservacao(o){this.observacaoRecebida=o,this.modalAcao==="aprovar"?this.aprovarComObservacao(o):this.modalAcao==="reprovar"&&this.reprovarComObservacao(o),this.modalAcao=null}onCancelObservacao(){this.modalAcao=null}aprovarComObservacao(o){let i=sessionStorage.getItem("ERPTOKEN");if(!i){this.poNotification.error("Sess\xE3o expirada. Fa\xE7a login novamente."),this.router.navigate(["/login"]);return}let e={};try{let a=JSON.parse(i);e={headers:new S().set("Content-Type","application/json").set("Authorization",`Bearer ${a.access_token}`)}}catch(a){console.error("Erro ao processar token:",a),this.poNotification.error("Erro na autentica\xE7\xE3o. Por favor, fa\xE7a login novamente."),this.router.navigate(["/login"]);return}let r="A";this.selectedItems.forEach(a=>{let t={codigo:a.codigo,aprov:r,obs:o};console.log("[API][FCWS0105] Enviando JSON:",t),this.http.post(`${M.apiUrl}/FCWS0105/new`,t,e).subscribe({next:n=>{this.poNotification.success(`T\xEDtulo ${a.codigo} aprovado com observa\xE7\xE3o!`),this.loadTableData()},error:n=>{this.poNotification.error(`Erro ao aprovar t\xEDtulo ${a.codigo}.`)}})})}reprovarComObservacao(o){let i=sessionStorage.getItem("ERPTOKEN");if(!i){this.poNotification.error("Sess\xE3o expirada. Fa\xE7a login novamente."),this.router.navigate(["/login"]);return}let e={};try{let a=JSON.parse(i);e={headers:new S().set("Content-Type","application/json").set("Authorization",`Bearer ${a.access_token}`)}}catch(a){console.error("Erro ao processar token:",a),this.poNotification.error("Erro na autentica\xE7\xE3o. Por favor, fa\xE7a login novamente."),this.router.navigate(["/login"]);return}let r="R";this.selectedItems.forEach(a=>{let t={codigo:a.codigo,aprov:r,obs:o};console.log("[API][FCWS0105] Enviando JSON:",t),this.http.post(`${M.apiUrl}/FCWS0105/new`,t,e).subscribe({next:n=>{this.poNotification.success(`T\xEDtulo ${a.codigo} reprovado com observa\xE7\xE3o!`),this.loadTableData()},error:n=>{this.poNotification.error(`Erro ao reprovar t\xEDtulo ${a.codigo}.`)}})})}static \u0275fac=function(i){return new(i||m)(_(J),_(ie),_(K),_(ue))};static \u0275cmp=E({type:m,selectors:[["app-aprovacao-titulos"]],viewQuery:function(i,e){if(i&1&&(w(T,5),w(Pe,5)),i&2){let r;A(r=P())&&(e.modalObs=r.first),A(r=P())&&(e.tableRef=r.first)}},decls:47,vars:30,consts:[["tableRef",""],[1,"po-container"],[1,"po-row","po-mb-3"],[1,"po-md-3","po-sm-12"],["p-label","Data inicial",3,"ngModelChange","ngModel"],["p-label","Data final",3,"ngModelChange","ngModel"],[1,"po-md-2","po-sm-12","po-align-self-end"],["p-label","Pesquisar",3,"p-click"],["class","po-md-3 po-sm-12",4,"ngFor","ngForOf"],["p-label","Exibir Pendentes Aprova\xE7\xE3o",3,"ngModelChange","ngModel"],["p-label","Exibir Aprovado",3,"ngModelChange","ngModel"],["p-label","Exibir Reprovados",3,"ngModelChange","ngModel"],[1,"po-row","po-mb-3",2,"align-items","center","gap","16px","flex-wrap","wrap","justify-content","space-between"],[2,"display","flex","gap","8px"],["p-label","Aprovar",3,"p-click","p-type"],["p-label","Reprovar",3,"p-click","p-type"],[2,"flex","1 1 400px","max-width","400px","display","flex","justify-content","flex-end"],["p-placeholder","Pesquisar","p-icon","po-icon-search",2,"width","100%","min-width","200px","max-width","400px",3,"ngModelChange","ngModel"],[1,"custom-table-container",2,"overflow-x","auto","width","100%"],[3,"p-auto-collapse","p-columns","p-hide-columns-manager","p-hide-table-search","p-items","p-sort","p-striped","p-actions","p-selectable","p-actions-right","p-show-more-disabled"],[1,"pagination-controls",2,"margin","8px 0","display","flex","align-items","center","gap","8px"],["po-button","","p-label","Anterior",3,"click","disabled"],["po-button","","p-label","Pr\xF3xima",3,"click","disabled"],[2,"margin-left","16px"],[3,"ngModelChange","change","ngModel"],[3,"value"],[3,"confirm","cancel"],[3,"p-title"],[2,"font-size","2em","font-weight","bold"],[4,"ngIf"]],template:function(i,e){if(i&1){let r=I();p(0,"div",1)(1,"h1"),g(2,"Painel de Aprova\xE7\xF5es"),s(),p(3,"div",2)(4,"div",3)(5,"po-datepicker",4),f("ngModelChange",function(t){return c(r),v(e.dataInicial,t)||(e.dataInicial=t),d(t)}),s()(),p(6,"div",3)(7,"po-datepicker",5),f("ngModelChange",function(t){return c(r),v(e.dataFinal,t)||(e.dataFinal=t),d(t)}),s()(),p(8,"div",6)(9,"po-button",7),C("p-click",function(){return c(r),d(e.onPesquisar())}),s()()(),p(10,"div",2),y(11,Te,6,4,"div",8),s(),p(12,"div",2)(13,"div",3)(14,"po-checkbox",9),f("ngModelChange",function(t){return c(r),v(e.exibirPendentes,t)||(e.exibirPendentes=t),d(t)}),s()(),p(15,"div",3)(16,"po-checkbox",10),f("ngModelChange",function(t){return c(r),v(e.exibirAprovados,t)||(e.exibirAprovados=t),d(t)}),s()(),p(17,"div",3)(18,"po-checkbox",11),f("ngModelChange",function(t){return c(r),v(e.exibirReprovados,t)||(e.exibirReprovados=t),d(t)}),s()()(),p(19,"div",12)(20,"div",13)(21,"po-button",14),C("p-click",function(){return c(r),d(e.abrirModalAcao("aprovar"))}),s(),p(22,"po-button",15),C("p-click",function(){return c(r),d(e.abrirModalAcao("reprovar"))}),s()(),p(23,"div",16)(24,"po-input",17),f("ngModelChange",function(t){return c(r),v(e.searchText,t)||(e.searchText=t),d(t)}),C("ngModelChange",function(){return c(r),d(e.onSearchChange())}),s()()(),p(25,"div",18),$(26,"po-table",19,0),s(),p(28,"div",20)(29,"button",21),C("click",function(){return c(r),d(e.page=e.page-1)}),s(),p(30,"span"),g(31),s(),p(32,"button",22),C("click",function(){return c(r),d(e.page=e.page+1)}),s(),p(33,"span",23),g(34,"Itens por p\xE1gina:"),s(),p(35,"select",24),f("ngModelChange",function(t){return c(r),v(e.pageSize,t)||(e.pageSize=t),d(t)}),C("change",function(){return c(r),d(e.page=1)}),p(36,"option",25),g(37,"5"),s(),p(38,"option",25),g(39,"10"),s(),p(40,"option",25),g(41,"20"),s(),p(42,"option",25),g(43,"50"),s(),p(44,"option",25),g(45,"100"),s()()()(),p(46,"app-aprovacao-observacao-modal",26),C("confirm",function(t){return c(r),d(e.onConfirmObservacao(t))})("cancel",function(){return c(r),d(e.onCancelObservacao())}),s()}i&2&&(l(5),h("ngModel",e.dataInicial),l(2),h("ngModel",e.dataFinal),l(4),u("ngForOf",e.cards),l(3),h("ngModel",e.exibirPendentes),l(2),h("ngModel",e.exibirAprovados),l(2),h("ngModel",e.exibirReprovados),l(3),u("p-type",e.primary),l(),u("p-type",e.danger),l(2),h("ngModel",e.searchText),l(2),u("p-auto-collapse",!0)("p-columns",e.columns)("p-hide-columns-manager",!0)("p-hide-table-search",!0)("p-items",e.pagedItems)("p-sort",!0)("p-striped",!0)("p-actions",e.actions)("p-selectable",!0)("p-actions-right",!0)("p-show-more-disabled",!0),l(3),u("disabled",e.page===1),l(2),Q("P\xE1gina ",e.page," de ",e.totalPages,""),l(),u("disabled",e.page===e.totalPages),l(3),h("ngModel",e.pageSize),l(),u("value",5),l(2),u("value",10),l(2),u("value",20),l(2),u("value",50),l(2),u("value",100))},dependencies:[N,H,O,V,Y,G,U,x,D,me,de,le,pe,se,ne,ee,Z,F,k,ae,ce,X,re,T],styles:[".po-container[_ngcontent-%COMP%]{padding:24px}.po-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px}.po-mb-3[_ngcontent-%COMP%]{margin-bottom:24px}.po-align-self-end[_ngcontent-%COMP%]{align-self:flex-end}[_nghost-%COMP%]     .po-table-actions .po-button, [_nghost-%COMP%]     .po-table-actions .po-button-default{padding:2px 8px!important;font-size:.8em!important;min-width:0!important;height:28px!important;line-height:1.2!important}[_nghost-%COMP%]     .po-table-actions .po-icon{font-size:1em!important}"]})};export{ge as AprovacaoTitulosComponent};
