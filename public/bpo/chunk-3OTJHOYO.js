import{c as V,d as k}from"./chunk-6COOJ4IH.js";import{Aa as F,Ia as j,Ja as $,aa as E,ba as z,f as b,g as y,j as C,la as A,q as P,qa as T,s as I,xa as _,za as D}from"./chunk-OPSSS4EV.js";import{Cb as p,Ib as u,Jb as c,Kb as m,Tb as v,bb as r,cb as l,kc as d,lc as f,mc as g,ob as h}from"./chunk-FMFEBW5D.js";var B=()=>({label:"Aprova\xE7\xE3o de T\xEDtulos",link:"/aprovacao-titulos"}),M=()=>({label:"Visualizar"}),R=(n,o)=>[n,o],N=n=>({items:n}),S=class n{constructor(o,t,e,s){this.route=o;this.router=t;this.http=e;this.proAppConfigService=s;let a=this.router.getCurrentNavigation();a?.extras.state&&(this.detalhes=a.extras.state)}codigo="";detalhes={};codigoImportacao="";items=[];columns=[{property:"prefixo",label:"Prefixo"},{property:"titulo",label:"T\xEDtulo"},{property:"tipo",label:"Tipo"},{property:"natureza",label:"Natureza"},{property:"codFornecedor",label:"Cod Fornecedor"},{property:"loja",label:"Loja"},{property:"nomeFornecedor",label:"Nome do Fornecedor"},{property:"emissao",label:"Emiss\xE3o"},{property:"vencimento",label:"Vencimento"},{property:"valor",label:"Valor"}];formatDateBr(o){if(!o)return"";if(/^\d{4}[-/]\d{2}[-/]\d{2}$/.test(o)){let[t,e,s]=o.split(/[-/]/);return`${s}/${e}/${t}`}return/^\d{8}$/.test(o)?`${o.substring(6,8)}/${o.substring(4,6)}/${o.substring(0,4)}`:o}ngOnInit(){this.detalhes&&Object.keys(this.detalhes).length>0?(this.codigoImportacao=this.detalhes.codigo||this.route.snapshot.params.id||this.route.snapshot.params.codigo,this.detalhes.arquivo=this.detalhes.arquivo,this.detalhes.tipo=this.detalhes.tipo,this.detalhes.data=this.detalhes.data?this.formatDateBr(this.detalhes.data):"",this.detalhes.hora=this.detalhes.hora,this.detalhes.valor=this.detalhes.valor,this.detalhes.usuario=this.detalhes.usuario):this.codigoImportacao=this.route.snapshot.params.id||this.route.snapshot.params.codigo;let o=this.proAppConfigService&&this.proAppConfigService.insideProtheus&&this.proAppConfigService.insideProtheus(),t=sessionStorage.getItem("ERPTOKEN"),e={};if(t)try{let a=JSON.parse(t);e={headers:new y().set("Content-Type","application/json").set("Authorization",`Bearer ${a.access_token}`)}}catch(a){console.error("Erro ao processar token:",a),alert("Erro na autentica\xE7\xE3o. Por favor, fa\xE7a login novamente."),this.router.navigate(["/login"]);return}if(!t&&!o){this.items=[];return}let s=`${V.apiUrl}/FCWS0104/get_all?codimp=${this.codigoImportacao}`;this.http.get(s,e).subscribe({next:a=>{this.items=(a.objects||[]).map(i=>({prefixo:i.prefixo,titulo:i.titulo,tipo:i.tipo,natureza:i.natureza,codFornecedor:i.codfor,loja:i.loja,nomeFornecedor:i.nomfor,emissao:this.formatDateBr(i.emissao),vencimento:this.formatDateBr(i.vencimento),valor:i.valor}))},error:a=>{a.status===401&&o?alert("Sess\xE3o Protheus expirada. Reabra o app pelo menu do Protheus."):a.status===401&&!o&&(alert("Sess\xE3o expirada. Por favor, fa\xE7a login novamente."),this.router.navigate(["/login"])),this.items=[]}})}voltar(){this.router.navigate(["/aprovacao-titulos"])}static \u0275fac=function(t){return new(t||n)(l(P),l(I),l(C),l(k))};static \u0275cmp=h({type:n,selectors:[["app-visualizar-importacao"]],decls:15,vars:20,consts:[[1,"po-row"],[1,"po-md-3"],["p-label","Voltar",3,"p-click"],[3,"p-title","p-breadcrumb"],[1,"po-row","po-mb-2"],["p-label","Cod. Importa\xE7\xE3o",1,"po-md-2",3,"p-value"],["p-label","Tipo",1,"po-md-1",3,"p-value"],["p-label","Data",1,"po-md-2",3,"p-value"],["p-label","Hora",1,"po-md-1",3,"p-value"],["p-label","Valor Total",1,"po-md-2",3,"p-value"],["p-label","Usu\xE1rio",1,"po-md-4",3,"p-value"],["p-label","Arquivo",1,"po-md-12",3,"p-value"],[1,"po-container","po-mt-1"],[3,"p-columns","p-items","p-striped","p-sort"]],template:function(t,e){t&1&&(u(0,"div",0)(1,"div",1)(2,"po-button",2),v("p-click",function(){return e.voltar()}),c()()(),u(3,"po-page-default",3)(4,"div",4),m(5,"po-info",5)(6,"po-info",6)(7,"po-info",7)(8,"po-info",8)(9,"po-info",9)(10,"po-info",10),c(),u(11,"div",4),m(12,"po-info",11),c(),u(13,"div",12),m(14,"po-table",13),c()()),t&2&&(r(3),p("p-title","Visualiza\xE7\xE3o da Importa\xE7\xE3o"+(e.codigoImportacao?" - "+e.codigoImportacao:""))("p-breadcrumb",f(18,N,g(15,R,d(13,B),d(14,M)))),r(2),p("p-value",e.detalhes.codigo||e.codigoImportacao),r(),p("p-value",e.detalhes.tipo),r(),p("p-value",e.detalhes.data),r(),p("p-value",e.detalhes.hora),r(),p("p-value",e.detalhes.valor),r(),p("p-value",e.detalhes.usuario),r(2),p("p-value",e.detalhes.arquivo),r(2),p("p-columns",e.columns)("p-items",e.items)("p-striped",!0)("p-sort",!0))},dependencies:[b,$,j,F,D,z,E,A,_,T],encapsulation:2})};export{S as VisualizarImportacaoComponent};
