import{a as ne,b as ae}from"./chunk-ZJTYN2NV.js";import{$ as m,$a as L,B as P,Da as R,Ea as W,Fa as A,Fb as oe,G as b,Ga as D,Gb as te,H as l,Ha as j,Ia as H,Ja as F,Jb as ie,K as p,Ka as z,L as r,M as w,N as M,O as C,P as f,X as v,Y as O,_ as u,_a as B,aa as h,ab as q,ba as x,bb as U,ca as y,da as S,fb as J,hb as G,ib as K,la as k,mb as Q,nb as X,oa as T,p as d,pa as N,pb as Y,q as c,ra as E,sb as Z,ua as V,x as s,xb as $,y as _,yb as ee,za as I}from"./chunk-DP6RW5WA.js";var se=()=>({label:"Aprova\xE7\xF5es",link:"/browse"}),le=a=>({label:a}),de=(a,o)=>[a,o],ce=a=>({items:a});function ge(a,o){if(a&1&&(p(0,"po-loading"),v(1),r()),a&2){let t=f();s(),O(t.loadingText)}}function ue(a,o){a&1&&(p(0,"span",25),v(1,"*"),r())}function me(a,o){a&1&&(p(0,"div",25),v(1," Campo obrigat\xF3rio "),r())}function he(a,o){if(a&1){let t=M();p(0,"po-button",26),C("p-click",function(){d(t);let i=f();return c(i.onApprove())}),r()}if(a&2){let t=f();l("p-loading",t.saving)("p-disabled",!t.observacao)}}function fe(a,o){if(a&1){let t=M();p(0,"po-button",27),C("p-click",function(){d(t);let i=f();return c(i.onReject())}),r()}if(a&2){let t=f();l("p-loading",t.saving)("p-disabled",!t.observacao)}}function _e(a,o){if(a&1){let t=M();p(0,"po-button",28),C("p-click",function(){d(t);let i=f();return c(i.onTransfer())}),r()}if(a&2){let t=f();l("p-loading",t.saving)("p-disabled",!t.observacao)}}var re=class a{constructor(o,t,e,i){this.http=o;this.router=t;this.poNotification=e;this.authService=i;this.columns=this.getColumns()}pageTitle="Medi\xE7\xE3o";loading=!1;loadingText="Carregando...";saving=!1;isReadOnly=!1;isApproveOperation=!1;isRejectOperation=!1;isTransferOperation=!1;currentOperation="";num="";clifor="";emissao=null;total="";tipo="";grupo="";status="";observacao="";dtlibera=null;columns=[];items=[];selectedItems=[];apiUrl=ne.apiUrl;getHttpHeaders(){let o=new N().set("Content-Type","application/json"),t=this.authService.getToken();return t?o=o.set("Authorization",`Bearer ${t}`):(console.warn("Token n\xE3o encontrado!"),this.router.navigate(["/login"])),{headers:o}}getColumns(){return[{property:"contrato",label:"Contrato",width:"20%"},{property:"clifor",label:"Cliente/Fornecedor",width:"50%"},{property:"planilha",label:"Planilha",width:"40%"},{property:"tipo",label:"Tipo",width:"20%"},{property:"valor",label:"Valor",width:"20%"},{property:"dias",label:"Dias Venc.",width:"20%"}]}ngOnInit(){let o=sessionStorage.getItem("operation"),t=sessionStorage.getItem("numId"),e=sessionStorage.getItem("medicaoData");if(console.log("Opera\xE7\xE3o recebida:",o),console.log("N\xFAmero da medi\xE7\xE3o:",t),console.log("Dados da medi\xE7\xE3o:",e),!o){console.error("Opera\xE7\xE3o n\xE3o informada"),this.poNotification.error("Opera\xE7\xE3o n\xE3o informada"),this.router.navigate(["/browse"]);return}if(!t){console.error("N\xFAmero da medi\xE7\xE3o n\xE3o informado"),this.poNotification.error("N\xFAmero da medi\xE7\xE3o n\xE3o informado"),this.router.navigate(["/browse"]);return}if(e){let i=JSON.parse(e);this.num=i.num||"",this.clifor=i.clifor||"",this.emissao=i.emissao?new Date(i.emissao):null;let g=typeof i.total=="string"?i.total.replace(/[^\d.-]/g,""):String(i.total||0),pe=parseFloat(g).toFixed(2).replace(".",",");this.total=`R$ ${pe}`,this.tipo=i.tipo||"",this.grupo=i.grupo||"",this.status=i.status||"",this.observacao=i.observacao||"",i.dtlibera&&i.dtlibera!=="00/00/00"&&i.dtlibera.trim()!==""?i.dtlibera.split("/").length===3?this.dtlibera=new Date(i.dtlibera):this.dtlibera=null:this.dtlibera=null,this.loadTableItems(),console.log("Dados carregados:",{num:this.num,clifor:this.clifor,emissao:this.emissao,total:this.total,tipo:this.tipo,grupo:this.grupo,status:this.status})}else{console.error("Dados da medi\xE7\xE3o n\xE3o encontrados"),this.poNotification.error("Dados da medi\xE7\xE3o n\xE3o encontrados"),this.router.navigate(["/browse"]);return}switch(console.log("Configurando opera\xE7\xE3o:",o),o){case"2":this.pageTitle="Visualizar Aprova\xE7\xE3o",this.isReadOnly=!0,this.isApproveOperation=!1,this.isRejectOperation=!1,this.currentOperation="visualizar",console.log("Modo Visualiza\xE7\xE3o configurado");break;case"3":this.pageTitle="Aprova\xE7\xE3o",this.isReadOnly=!1,this.isApproveOperation=!0,this.isRejectOperation=!1,this.currentOperation="aprovar",console.log("Modo Aprova\xE7\xE3o configurado");break;case"4":this.pageTitle="Reprova\xE7\xE3o",this.isReadOnly=!1,this.isApproveOperation=!1,this.isRejectOperation=!0,this.currentOperation="recusar",console.log("Modo Recusa configurado");break;case"5":this.pageTitle="Transfer\xEAncia",this.isReadOnly=!1,this.isApproveOperation=!1,this.isTransferOperation=!0,this.currentOperation="transferir",console.log("Modo Transferir configurado");break;default:console.error("Opera\xE7\xE3o inv\xE1lida:",o),this.poNotification.error("Opera\xE7\xE3o inv\xE1lida"),this.router.navigate(["/browse"]);return}}loadTableItems(){this.loading=!0,console.log("Buscando itens para a medi\xE7\xE3o:",this.num),this.http.get(`${this.apiUrl}/rest/WSCN9ITEM/get_id?id=${this.num}`,this.getHttpHeaders()).subscribe({next:o=>{console.log("Resposta do servidor:",o),o?(this.items=[{contrato:o.contrato||"",clifor:o.clifor||"",planilha:o.planilha||"",tipo:o.tipo||"",valor:o.valor||"",dias:o.dias||""}],console.log("Itens processados:",this.items)):(this.poNotification.warning("N\xE3o foi localizado planilha para este contrato"),this.items=[]),this.loading=!1},error:o=>{console.error("Erro ao carregar itens:",o),o.status===401?(this.poNotification.error("Sess\xE3o expirada. Por favor, fa\xE7a login novamente."),this.router.navigate(["/login"])):this.poNotification.warning("N\xE3o foi localizado planilha para este contrato"),this.loading=!1,this.items=[]}})}onApprove(){if(!this.num){this.poNotification.error("N\xFAmero da medi\xE7\xE3o n\xE3o informado");return}if(!this.observacao){this.poNotification.error("\xC9 necess\xE1rio preencher uma observa\xE7\xE3o");return}this.saving=!0;let o={num:this.num,clifor:this.clifor,emissao:this.emissao,total:this.total,tipo:this.tipo,grupo:this.grupo,status:"03",observacao:this.observacao,operation:"3"};console.log("Payload enviado para aprova\xE7\xE3o:",JSON.stringify(o,null,2)),this.http.post(`${this.apiUrl}/rest/WSSCRMED/new`,o,this.getHttpHeaders()).subscribe({next:t=>{console.log("Resposta da aprova\xE7\xE3o:",t),this.poNotification.success("Medi\xE7\xE3o aprovada com sucesso!"),this.router.navigate(["/browse"])},error:t=>{console.error("Erro ao aprovar:",t),this.poNotification.error("Erro ao aprovar a medi\xE7\xE3o"),this.saving=!1},complete:()=>{this.saving=!1}})}onReject(){if(!this.num){this.poNotification.error("N\xFAmero da medi\xE7\xE3o n\xE3o informado");return}if(!this.observacao){this.poNotification.error("\xC9 necess\xE1rio preencher uma observa\xE7\xE3o");return}this.saving=!0;let o={num:this.num,clifor:this.clifor,emissao:this.emissao,total:this.total,tipo:this.tipo,grupo:this.grupo,status:"05",observacao:this.observacao,operation:"4"};console.log("Payload enviado para rejei\xE7\xE3o:",JSON.stringify(o,null,2)),this.http.post(`${this.apiUrl}/rest/WSSCRMED/new`,o,this.getHttpHeaders()).subscribe({next:t=>{console.log("Resposta da rejei\xE7\xE3o:",t),this.poNotification.success("Medi\xE7\xE3o rejeitada com sucesso!"),this.router.navigate(["/browse"])},error:t=>{console.error("Erro ao rejeitar:",t),this.poNotification.error("Erro ao rejeitar a medi\xE7\xE3o"),this.saving=!1},complete:()=>{this.saving=!1}})}onBack(){sessionStorage.removeItem("medicaoData"),this.router.navigate(["/browse"])}onTransfer(){if(!this.num){this.poNotification.error("N\xFAmero da medi\xE7\xE3o n\xE3o informado");return}if(!this.observacao){this.poNotification.error("\xC9 necess\xE1rio preencher uma observa\xE7\xE3o");return}this.saving=!0;let o={num:this.num,clifor:this.clifor,emissao:this.emissao,total:this.total,tipo:this.tipo,grupo:this.grupo,status:"04",observacao:this.observacao,operation:"5"};console.log("Payload enviado para transfer\xEAncia:",JSON.stringify(o,null,2)),this.http.post(`${this.apiUrl}/rest/WSSCRMED/new`,o,this.getHttpHeaders()).subscribe({next:t=>{console.log("Resposta da transfer\xEAncia:",t),this.poNotification.success("Transfer\xEAncia realizada com sucesso!"),this.router.navigate(["/browse"])},error:t=>{console.error("Erro ao transferir:",t),this.poNotification.error("Erro ao transferir a medi\xE7\xE3o"),this.saving=!1},complete:()=>{this.saving=!1}})}getStatusLabel(o){return{"01":"Pendente N\xEDveis","02":"Pendente","03":"Aprovado","04":"Bloqueado","05":"Aprovado/rejeitado pelo n\xEDvel"}[o]||o}getStatusColor(o){return{"01":"#745678","02":"blue","03":"green","04":"#d8a20e","05":"rgb(201, 53, 125)"}[o]||"default"}getStatusIcon(o){return{"01":"po-icon-exclamation","02":"po-icon-star-filled","03":"po-icon-ok","04":"po-icon-lock","05":"po-icon-close"}[o]||""}static \u0275fac=function(t){return new(t||a)(_(E),_(I),_(J),_(ae))};static \u0275cmp=P({type:a,selectors:[["app-manipulate"]],decls:34,vars:31,consts:[["groupForm","ngForm"],[3,"p-title","p-breadcrumb"],["id","obs1"],["id","obs2"],[4,"ngIf"],[1,"po-row"],["name","num","p-clean","true","p-label","Medi\xE7\xE3o","p-required","true","p-readonly","true",1,"po-md-2",3,"ngModelChange","ngModel"],["name","clifor","p-clean","true","p-label","Cliente/Fornecedor","p-required","true","p-readonly","true",1,"po-md-10",3,"ngModelChange","ngModel"],["name","emissao","p-clean","true","p-label","Emiss\xE3o","p-format","dd/MM/yyyy","p-readonly","true",1,"po-md-3",3,"ngModelChange","ngModel"],["name","total","p-clean","true","p-label","Valor","p-readonly","true",1,"po-md-2",3,"ngModelChange","ngModel"],["name","tipo","p-clean","true","p-label","Tipo","p-readonly","true",1,"po-md-2",3,"ngModelChange","ngModel"],["name","grupo","p-clean","true","p-label","Grupo","p-readonly","true",1,"po-md-2",3,"ngModelChange","ngModel"],[1,"po-md-3",3,"p-value","p-color","p-icon"],["name","dtlibera","p-clean","true","p-label","Data Aprova\xE7\xE3o/Reprova\xE7\xE3o","p-format","dd/MM/yyyy","p-readonly","true",1,"po-md-3",3,"ngModelChange","ngModel"],[1,"po-md-12"],[1,"po-field-container-compact"],[1,"po-label"],["class","po-text-danger",4,"ngIf"],["name","observacao","placeholder","Digite aqui sua observa\xE7\xE3o...","rows","3","required","",1,"po-input-multiline",3,"ngModelChange","ngModel","readonly"],[1,"po-row","table-row"],[3,"p-columns","p-items","p-striped"],["p-label","Voltar","p-kind","secondary",1,"po-md-3",3,"p-click"],["class","po-md-3","p-label","Aprovar","p-kind","success",3,"p-loading","p-disabled","p-click",4,"ngIf"],["class","po-md-3","p-label","Recusar","p-kind","danger",3,"p-loading","p-disabled","p-click",4,"ngIf"],["class","po-md-3","p-label","Transferir","p-kind","danger",3,"p-loading","p-disabled","p-click",4,"ngIf"],[1,"po-text-danger"],["p-label","Aprovar","p-kind","success",1,"po-md-3",3,"p-click","p-loading","p-disabled"],["p-label","Recusar","p-kind","danger",1,"po-md-3",3,"p-click","p-loading","p-disabled"],["p-label","Transferir","p-kind","danger",1,"po-md-3",3,"p-click","p-loading","p-disabled"]],template:function(t,e){if(t&1){let i=M();p(0,"po-page-default",1),w(1,"div",2)(2,"div",3),b(3,ge,2,1,"po-loading",4),p(4,"form",null,0)(6,"div",5)(7,"po-input",6),h("ngModelChange",function(n){return d(i),m(e.num,n)||(e.num=n),c(n)}),r(),p(8,"po-input",7),h("ngModelChange",function(n){return d(i),m(e.clifor,n)||(e.clifor=n),c(n)}),r()(),p(9,"div",5)(10,"po-datepicker",8),h("ngModelChange",function(n){return d(i),m(e.emissao,n)||(e.emissao=n),c(n)}),r(),p(11,"po-input",9),h("ngModelChange",function(n){return d(i),m(e.total,n)||(e.total=n),c(n)}),r(),p(12,"po-input",10),h("ngModelChange",function(n){return d(i),m(e.tipo,n)||(e.tipo=n),c(n)}),r(),p(13,"po-input",11),h("ngModelChange",function(n){return d(i),m(e.grupo,n)||(e.grupo=n),c(n)}),r(),w(14,"po-tag",12),r(),p(15,"div",5)(16,"po-datepicker",13),h("ngModelChange",function(n){return d(i),m(e.dtlibera,n)||(e.dtlibera=n),c(n)}),r()(),p(17,"div",5)(18,"div",14)(19,"div",15)(20,"label",16),v(21," Observa\xE7\xE3o "),b(22,ue,2,0,"span",17),r(),p(23,"textarea",18),h("ngModelChange",function(n){return d(i),m(e.observacao,n)||(e.observacao=n),c(n)}),r(),b(24,me,2,0,"div",17),r()()(),p(25,"div",19)(26,"div",14),w(27,"po-table",20),r()(),p(28,"div",5)(29,"div",14)(30,"po-button",21),C("p-click",function(){return d(i),c(e.onBack())}),r(),b(31,he,1,2,"po-button",22)(32,fe,1,2,"po-button",23)(33,_e,1,2,"po-button",24),r()()()()}t&2&&(l("p-title",e.pageTitle)("p-breadcrumb",y(29,ce,S(26,de,x(23,se),y(24,le,e.pageTitle)))),s(3),l("ngIf",e.loading),s(4),u("ngModel",e.num),s(),u("ngModel",e.clifor),s(2),u("ngModel",e.emissao),s(),u("ngModel",e.total),s(),u("ngModel",e.tipo),s(),u("ngModel",e.grupo),s(),l("p-value",e.getStatusLabel(e.status))("p-color",e.getStatusColor(e.status))("p-icon",e.getStatusIcon(e.status)),s(2),u("ngModel",e.dtlibera),s(6),l("ngIf",!e.isReadOnly),s(),u("ngModel",e.observacao),l("readonly",e.isReadOnly),s(),l("ngIf",!e.observacao&&!e.isReadOnly),s(3),l("p-columns",e.columns)("p-items",e.items)("p-striped",!0),s(4),l("ngIf",e.isApproveOperation),s(),l("ngIf",e.isRejectOperation),s(),l("ngIf",e.isTransferOperation))},dependencies:[T,k,z,H,R,W,A,F,j,D,ie,q,Q,Z,G,B,oe,Y,te,U,ee,L,$,X,K,V],styles:[".custom-wrapper[_ngcontent-%COMP%]{position:fixed;left:240px;top:0;right:0;height:100vh;background:#fff;overflow-y:auto;z-index:1}[_nghost-%COMP%]{display:block;width:100%}[_nghost-%COMP%]     .po-wrapper{margin-left:0!important}[_nghost-%COMP%]     .po-page-default{margin:0;padding:8px}[_nghost-%COMP%]     .po-page-content{margin-left:0!important}[_nghost-%COMP%]     .po-row{margin:4px 0;display:flex;align-items:flex-start;flex-wrap:nowrap}[_nghost-%COMP%]     .po-row .po-datepicker{flex-shrink:0}[_nghost-%COMP%]     .po-input, [_nghost-%COMP%]     .po-combo, [_nghost-%COMP%]     .po-decimal, [_nghost-%COMP%]     .po-datepicker, [_nghost-%COMP%]     .po-tag{width:100%;margin-bottom:8px}[_nghost-%COMP%]     .po-tag{margin-top:20px;height:44px;display:flex;align-items:center;justify-content:center;padding:0 16px;font-size:14px;font-weight:500}[_nghost-%COMP%]     .po-tag  .po-tag-value{margin:0}[_nghost-%COMP%]     .po-input-multiline{width:100%;min-height:100px;padding:8px;border:1px solid #e6e6e6;border-radius:3px;font-size:14px;line-height:1.5;resize:vertical;background-color:#fff;margin-bottom:8px}[_nghost-%COMP%]     .po-input-multiline:focus{border-color:#0c9abe;outline:none;box-shadow:0 0 0 1px #0c9abe}[_nghost-%COMP%]     .po-input-multiline[readonly]{background-color:#f5f5f5;cursor:not-allowed}[_nghost-%COMP%]     .po-label{display:block;margin-bottom:4px;font-size:14px;font-weight:500;color:#4a5c7b}[_nghost-%COMP%]     .po-text-danger{color:#c94215;font-size:12px;margin-top:4px}[_nghost-%COMP%]     hr{margin:12px 0;border:0;border-top:1px solid #e7e7e7}[_nghost-%COMP%]     .po-table{margin-top:0;max-height:200px;overflow-y:auto}[_nghost-%COMP%]     .po-table-container{margin:0;padding:0}[_nghost-%COMP%]     .po-table-header-cell{position:sticky;top:0;background-color:#f8f8f8;z-index:1}[_nghost-%COMP%]     .po-page-header{padding:8px 0;margin-bottom:8px}[_nghost-%COMP%]     .po-breadcrumb{margin-bottom:8px}[_nghost-%COMP%]     .po-row{margin:4px 0}[_nghost-%COMP%]     .po-row.table-row{margin-top:0}[_nghost-%COMP%]     .po-datepicker .po-input{width:100%;min-width:140px}@media screen and (max-width: 1024px){[_nghost-%COMP%]     .po-wrapper, [_nghost-%COMP%]     .po-page-content{margin-left:0!important}}@media screen and (max-width: 768px){[_nghost-%COMP%]     .po-wrapper, [_nghost-%COMP%]     .po-page-content{margin-left:0!important}[_nghost-%COMP%]     .po-page-default{padding:8px}}.container-centered[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:20px}.po-row[_ngcontent-%COMP%]{margin-bottom:20px}.actions-row[_ngcontent-%COMP%]{margin-top:40px}.actions-row[_ngcontent-%COMP%]   .po-button[_ngcontent-%COMP%]{width:100%}po-table[_ngcontent-%COMP%]{margin-top:20px}po-tag[_ngcontent-%COMP%]{display:inline-block;margin:10px 0}po-textarea[_ngcontent-%COMP%]{margin:20px 0}.po-wrapper[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:16px}.po-row[_ngcontent-%COMP%]{margin:16px 0}.po-field-container[_ngcontent-%COMP%]{margin-bottom:16px}.po-field-container-compact[_ngcontent-%COMP%]{margin-bottom:4px}.po-field-container-compact[_ngcontent-%COMP%]   .po-input-multiline[_ngcontent-%COMP%]{margin-bottom:4px;min-height:80px}.po-field-container-compact[_ngcontent-%COMP%]   .po-label[_ngcontent-%COMP%]{margin-bottom:2px}.po-input-multiline[_ngcontent-%COMP%]{width:100%;min-height:100px;padding:8px;border:1px solid #e6e6e6;border-radius:3px;font-size:14px;line-height:1.5;resize:vertical}.po-input-multiline[_ngcontent-%COMP%]:focus{border-color:#0c9abe;outline:none;box-shadow:0 0 0 1px #0c9abe}.po-input-multiline[readonly][_ngcontent-%COMP%]{background-color:#f5f5f5;cursor:not-allowed}.po-button[_ngcontent-%COMP%]{margin-right:8px}.table-row[_ngcontent-%COMP%]{margin-top:0}.table-row[_ngcontent-%COMP%]   .po-table[_ngcontent-%COMP%]{margin-top:0;border-top:1px solid #e7e7e7}.actions-container[_ngcontent-%COMP%]{margin:8px 0}form[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   .po-row[_ngcontent-%COMP%]:first-child{margin-top:0}"]})};export{re as ManipulateComponent};
