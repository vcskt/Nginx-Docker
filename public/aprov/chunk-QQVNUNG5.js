import{a as A,b as R}from"./chunk-ZJTYN2NV.js";import{Ab as T,B as h,H as p,Jb as S,K as a,Ka as v,L as l,M as s,bb as P,fb as y,jb as C,kb as w,oa as g,pa as c,pb as M,ra as m,ua as b,wb as O,x as r,xa as f,xb as I,y as n,za as x,zb as _}from"./chunk-DP6RW5WA.js";var k=class d{constructor(t,e,o,i,u){this.http=t;this.router=e;this.route=o;this.authService=i;this.poNotification=u}columns=[];items=[];actions=[];loading=!1;saving=!1;num="";clifor="";procedencia="";status="";apiUrl=A.apiUrl;selectedItem;pendingType="P";documentType="MD";currentFilter="P";filterButtons=[{label:"Pendentes",icon:"po-icon-star-filled",action:()=>this.setFilter("P")},{label:"Aprovados",icon:"po-icon-ok",action:()=>this.setFilter("A")},{label:"Reprovados",icon:"po-icon-close",action:()=>this.setFilter("R")},{label:"Todos",icon:"po-icon-list",action:()=>this.setFilter("T")},{label:"Atualizar Browse",icon:"po-icon-refresh",action:this.refreshBrowse.bind(this)}];ngOnInit(){if(this.columns=this.getColumns(),!this.authService.isAuthenticated()){console.warn("Usu\xE1rio n\xE3o autenticado!"),this.router.navigate(["/login"]);return}this.route.queryParams.subscribe(e=>{switch(e.view){case"all":this.pendingType="T";break;case"approved":this.pendingType="A";break;case"rejected":this.pendingType="R";break;default:this.pendingType="P"}switch(this.currentFilter=this.pendingType,e.type){case"contract":this.documentType="CT";break;case"purchase-req":this.documentType="SC";break;case"purchase-order":this.documentType="PC";break;case"batch":this.documentType="LT";break;case"zero-box":this.documentType="ZC";break;case"transfer":this.documentType="TR";break;case"absence":this.documentType="AT";break;default:this.documentType="MD"}this.configureActions(),this.loadItems(),this.updateFilterButtonStyles()});let t=sessionStorage.getItem("selectedIndex");if(t&&this.items.length>0){let e=parseInt(t);e>=0&&e<this.items.length&&(this.selectedItem=this.items[e])}sessionStorage.setItem("numId",""),sessionStorage.setItem("operation","")}configureActions(){this.pendingType==="T"?this.actions=[{label:"Visualizar",icon:"po-icon-eye",action:this.onView.bind(this)},{label:"Transferir",icon:"po-icon-change",action:this.onTransfer.bind(this)}]:this.pendingType==="A"||this.pendingType==="R"?this.actions=[{label:"Visualizar",icon:"po-icon-eye",action:this.onView.bind(this)}]:this.documentType==="TR"?this.actions=[{label:"Visualizar",icon:"po-icon-eye",action:this.onView.bind(this)},{label:"Aprovar",icon:"po-icon-ok",action:this.onApprove.bind(this)},{label:"Reprovar",icon:"po-icon-close",action:this.onReject.bind(this)},{label:"Transferir",icon:"po-icon-change",action:this.onTransfer.bind(this)}]:this.actions=[{label:"Visualizar",icon:"po-icon-eye",action:this.onView.bind(this)},{label:"Aprovar",icon:"po-icon-ok",action:this.onApprove.bind(this)},{label:"Reprovar",icon:"po-icon-close",action:this.onReject.bind(this)},{label:"Transferir",icon:"po-icon-change",action:this.onTransfer.bind(this)}]}getHttpOptions(){let t=this.authService.getToken();return t?{headers:new c().set("Content-Type","application/json").set("Authorization",`Bearer ${t}`)}:(console.warn("Token n\xE3o encontrado no AuthService!"),this.poNotification.error("Sess\xE3o expirada. Por favor, fa\xE7a login novamente."),this.router.navigate(["/login"]),{headers:new c})}loadItems(){this.loading=!0;let t=this.authService.getUsername()||"000000";console.log("LoadItems - Iniciando chamada..."),console.log("Username:",t),console.log("Tipo de Pend\xEAncia:",this.pendingType),console.log("Tipo de Documento:",this.documentType),this.http.get(`${this.apiUrl}/rest/WSSCRMED/get_all?limit=100&usur=${t}&tipo=${this.documentType}&pendente=${this.pendingType}`,this.getHttpOptions()).subscribe({next:e=>{console.log("LoadItems - Resposta recebida:",e),e.objects?this.items=e.objects.map(o=>{let i=String(o.status||"").trim(),u=i.length===1?`0${i}`:i;return{num:String(o.num||"").trim(),clifor:String(o.clifor||"").trim(),emissao:o.emissao,total:o.total,tipo:o.tipo,grupo:o.grupo,status:u,observacao:o.observacao||"",dtlibera:o.dtlibera||""}}):e.errorId&&(console.log("Nenhum dado encontrado (errorId recebido)"),this.items=[],this.poNotification.information("Nenhum dado encontrado para os filtros selecionados")),console.log("Items mapeados:",this.items)},error:e=>{console.error("Falha ao buscar os dados:",e),e.status===401?(this.poNotification.error("Sess\xE3o expirada. Por favor, fa\xE7a login novamente."),this.authService.logout()):e.error?.errorId?(console.log("Nenhum dado encontrado (errorId no erro)"),this.items=[],this.poNotification.information("Nenhum dado encontrado para os filtros selecionados")):this.poNotification.error("Erro ao carregar os dados. Por favor, tente novamente."),this.items=[]},complete:()=>{this.loading=!1}})}getItems(){return this.items}getColumns(){return[{property:"num",label:"Cod. Aprova\xE7\xE3o",width:"100px",type:"link",action:(t,e)=>this.onView(e)},{property:"clifor",label:"Cliente/Fornecedor",width:"300px"},{property:"emissao",label:"Emiss\xE3o",width:"120px",type:"date",format:"dd/MM/yyyy"},{property:"total",label:"Valor",width:"150px",type:"currency",format:"BRL"},{property:"tipo",label:"Tipo",width:"80px"},{property:"grupo",label:"Grupo",width:"100px"},{property:"status",label:"Status",type:"label",width:"180px",labels:[{value:"01",color:"#745678",label:"Pendente N\xEDveis",icon:"po-icon-exclamation"},{value:"02",color:"#2196F3",label:"Pendente",icon:"po-icon-star-filled"},{value:"03",color:"#4CAF50",label:"Aprovado",icon:"po-icon-ok"},{value:"04",color:"#FFC107",label:"Bloqueado",icon:"po-icon-lock"},{value:"05",color:"#FF9800",label:"Aprovado/rejeitado pelo n\xEDvel",icon:"po-icon-warning"},{value:"06",color:"#F44336",label:"Rejeitado",icon:"po-icon-minus-circle"},{value:"07",color:"#9C27B0",label:"Rejeitado ou Bloqueado por outro usu\xE1rio",icon:"po-icon-delete"}]}]}refreshBrowse(){this.loadItems();let t=new Date,e=`Abaixo as informa\xE7\xF5es dos Medi\xE7\xF5es Pendentes de Aprova\xE7\xE3o (atualizado em ${t.getDay()}/${t.getMonth()}/${t.getFullYear()} \xE0s ${t.getHours()}:${t.getMinutes()}:${t.getSeconds()})`,o=document.getElementsByClassName("po-info-value")[0];o&&(o.innerHTML=e)}newButton(){sessionStorage.setItem("numId",""),sessionStorage.setItem("operation","3"),this.router.navigate(["/manipulate"])}onView(t){console.log("Visualizando item:",t),console.log("Definindo opera\xE7\xE3o de visualiza\xE7\xE3o (2)"),sessionStorage.setItem("numId",t.num),sessionStorage.setItem("operation","2"),sessionStorage.setItem("medicaoData",JSON.stringify(t)),this.router.navigate(["/manipulate"])}onApprove(t){console.log("Aprovando item:",t),console.log("Definindo opera\xE7\xE3o de aprova\xE7\xE3o (3)"),sessionStorage.setItem("numId",t.num),sessionStorage.setItem("operation","3"),sessionStorage.setItem("medicaoData",JSON.stringify(t)),this.router.navigate(["/manipulate"])}onReject(t){console.log("Rejeitando item:",t),console.log("Definindo opera\xE7\xE3o de rejei\xE7\xE3o (4)"),sessionStorage.setItem("numId",t.num),sessionStorage.setItem("operation","4"),sessionStorage.setItem("medicaoData",JSON.stringify(t)),this.router.navigate(["/manipulate"])}onTransfer(t){console.log("Transferindo item:",t),console.log("Definindo opera\xE7\xE3o de transferencia (5)"),sessionStorage.setItem("numId",t.num),sessionStorage.setItem("operation","5"),sessionStorage.setItem("medicaoData",JSON.stringify(t)),this.router.navigate(["/manipulate"])}loadnum(t){t&&(this.loading=!0,this.http.get(`${this.apiUrl}/rest/WSSCRMED/get/${t}`,this.getHttpOptions()).subscribe({next:e=>{if(e.objects&&e.objects.length>0){let o=e.objects[0]}},error:e=>{console.error("Error:",e),this.loading=!1},complete:()=>{this.loading=!1}}))}onSelectRow(t){this.selectedItem=t;let e=this.items.findIndex(o=>o.num===t.num);sessionStorage.setItem("selectedIndex",e.toString())}moveUp(){if(!this.selectedItem)return;let t=this.items.findIndex(e=>e.num===this.selectedItem.num);t>0&&(this.selectedItem=this.items[t-1],sessionStorage.setItem("selectedIndex",(t-1).toString()),this.onSelectRow(this.selectedItem))}moveDown(){if(!this.selectedItem)return;let t=this.items.findIndex(e=>e.num===this.selectedItem.num);t<this.items.length-1&&(this.selectedItem=this.items[t+1],sessionStorage.setItem("selectedIndex",(t+1).toString()),this.onSelectRow(this.selectedItem))}setFilter(t){this.pendingType=t,this.currentFilter=t,this.configureActions(),this.loadItems(),setTimeout(()=>this.updateFilterButtonStyles(),0)}updateFilterButtonStyles(){setTimeout(()=>{document.querySelectorAll(".filter-buttons .po-button").forEach((e,o)=>{this.currentFilter==="P"&&o===0||this.currentFilter==="A"&&o===1||this.currentFilter==="R"&&o===2||this.currentFilter==="T"&&o===3?e.classList.add("active"):e.classList.remove("active")})},100)}static \u0275fac=function(e){return new(e||d)(n(m),n(x),n(f),n(R),n(y))};static \u0275cmp=h({type:d,selectors:[["app-browse"]],decls:8,vars:11,consts:[[1,"custom-wrapper"],[1,"content-area"],["p-label","PORTAL DE APROVA\xC7\xC3O","p-value","Abaixo as medi\xE7\xF5es pendentes para aprova\xE7\xE3o"],[1,"actions-container"],[1,"filter-buttons"],[3,"p-buttons"],[1,"custom-table-container"],[3,"p-auto-collapse","p-columns","p-hide-columns-manager","p-hide-table-search","p-items","p-sort","p-striped","p-actions","p-actions-right","p-show-more-disabled"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"div",1),s(2,"po-info",2),a(3,"div",3)(4,"div",4),s(5,"po-button-group",5),l()(),a(6,"div",6),s(7,"po-table",7),l()()()),e&2&&(r(5),p("p-buttons",o.filterButtons),r(2),p("p-auto-collapse",!0)("p-columns",o.columns)("p-hide-columns-manager",!0)("p-hide-table-search",!1)("p-items",o.items)("p-sort",!0)("p-striped",!0)("p-actions",o.actions)("p-actions-right",!0)("p-show-more-disabled",!0))},dependencies:[g,v,S,C,_,M,T,P,b,I,O,w],styles:["[_nghost-%COMP%]{display:block;position:relative;width:100%;height:100%}  .po-page{margin-left:0!important;padding-left:0!important}  .po-page-content{width:100%!important}.po-row[_ngcontent-%COMP%]{margin:0;width:100%}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;margin:10px 0;padding:0 10px;width:100%}.button-container[_ngcontent-%COMP%]   .po-button-group[_ngcontent-%COMP%]{width:auto}.table-container[_ngcontent-%COMP%]{position:relative;width:100%;overflow-x:auto;padding:0 10px}.po-button[_ngcontent-%COMP%]{margin-right:8px}[_nghost-%COMP%]     .po-container{padding:0!important;margin:0!important}[_nghost-%COMP%]     .po-table{width:100%;border:1px solid #e7e7e7}[_nghost-%COMP%]     .po-table .po-table-header{background-color:#f8f8f8}[_nghost-%COMP%]     .po-table .po-table-header th{padding:8px 12px}[_nghost-%COMP%]     .po-table .po-table-row td{padding:8px 12px}[_nghost-%COMP%]     .po-table-container{margin:0;width:100%}[_nghost-%COMP%]     .po-info{padding:10px;margin:0 0 10px;width:100%}[_nghost-%COMP%]     .po-table{font-size:16px;width:100%}[_nghost-%COMP%]     .po-table-header{font-size:17px;font-weight:600;height:48px;line-height:48px}[_nghost-%COMP%]     .po-table-header-master-detail{width:48px}[_nghost-%COMP%]     .po-table-column-detail{width:48px}[_nghost-%COMP%]     .po-table-container{border:2px solid var(--color-border);border-radius:4px;width:100%;margin:0}[_nghost-%COMP%]     .po-table-container .po-table-row{height:44px;line-height:44px}[_nghost-%COMP%]     .po-table-container .po-table-column{padding:0 12px}[_nghost-%COMP%]     .po-clickable{cursor:pointer}[_nghost-%COMP%]     .po-button-group{display:flex;justify-content:center;gap:32px;width:100%}[_nghost-%COMP%]     .po-button-group .po-button{flex:0 1 auto}[_nghost-%COMP%]     .po-info{font-size:17px;margin:20px 0;width:100%;text-align:center}[_nghost-%COMP%]     .po-info .po-info-label{font-size:20px;font-weight:600;margin-bottom:10px;display:block;color:#4a5c7b}[_nghost-%COMP%]     .po-info .po-info-value{line-height:1.4;display:block;color:#666}[_nghost-%COMP%]     .po-icon{font-size:18px}[_nghost-%COMP%]     .po-tag{font-size:14px;padding:6px 20px;border-radius:4px;min-width:120px;text-align:center}[_nghost-%COMP%]     .po-table-column-grupo{min-width:120px}[_nghost-%COMP%]     .po-table-column-descricao{min-width:300px}[_nghost-%COMP%]     .po-table-column-procedencia{min-width:180px}[_nghost-%COMP%]     .po-table-column-status{min-width:150px}@media screen and (max-width: 1024px){.po-wrapper[_ngcontent-%COMP%]{width:calc(100vw - 260px)}}@media screen and (max-width: 768px){.po-wrapper[_ngcontent-%COMP%]{left:0;width:100%}}.custom-wrapper[_ngcontent-%COMP%]{position:fixed;left:300px;top:0;right:0;height:calc(100vh - 64px);background:#fff;display:flex;flex-direction:column;padding-bottom:16px}.content-area[_ngcontent-%COMP%]{flex:1;padding:16px 16px 0;display:flex;flex-direction:column;min-height:0}.actions-container[_ngcontent-%COMP%]{margin:16px 0;padding:0;display:flex;justify-content:center;align-items:center}.filter-buttons[_ngcontent-%COMP%]{display:flex;justify-content:center}.filter-buttons[_ngcontent-%COMP%]     .po-button-group{display:flex;gap:8px}.filter-buttons[_ngcontent-%COMP%]     .po-button-group .po-button{min-width:100px;height:32px;font-size:13px;border-radius:16px;transition:all .2s ease}.filter-buttons[_ngcontent-%COMP%]     .po-button-group .po-button:hover{transform:translateY(-1px);box-shadow:0 2px 4px #0000001a}.filter-buttons[_ngcontent-%COMP%]     .po-button-group .po-button.active{background-color:#0071bd!important;border-color:#0071bd!important;color:#fff!important}.browse-container[_ngcontent-%COMP%]{display:flex;align-items:flex-start;margin:16px 0;width:100%}.browse-navigation[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-right:16px;padding-top:48px}.browse-navigation[_ngcontent-%COMP%]   .po-button[_ngcontent-%COMP%]{margin-bottom:8px;min-width:36px;padding:0;height:36px}.browse-navigation[_ngcontent-%COMP%]   .po-button[_ngcontent-%COMP%]     .po-button{padding:0;min-width:36px}.custom-table-container[_ngcontent-%COMP%]{flex:1;overflow:auto;border:1px solid #e7e7e7;border-radius:3px;min-height:0}[_nghost-%COMP%]     .po-table{min-width:1030px}[_nghost-%COMP%]     .po-table .po-table-header-cell{padding:8px 12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;background-color:#f8f8f8;position:sticky;top:0;z-index:1}[_nghost-%COMP%]     .po-table .po-table-column{padding:8px 12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}[_nghost-%COMP%]     .po-table .po-table-column-clifor{max-width:300px}[_nghost-%COMP%]     .po-table .po-table-column-status{min-width:180px}[_nghost-%COMP%]     .po-info{text-align:center;margin-bottom:16px}[_nghost-%COMP%]     .po-info .po-info-label{font-size:20px;font-weight:600;color:#4a5c7b;margin-bottom:8px}[_nghost-%COMP%]     .po-info .po-info-value{font-size:16px;color:#666}[_nghost-%COMP%]     .po-button-group{display:flex;gap:8px;justify-content:center}@media screen and (max-width: 1200px){.custom-wrapper[_ngcontent-%COMP%]{left:200px}}@media screen and (max-width: 768px){.custom-wrapper[_ngcontent-%COMP%]{left:0}.content-area[_ngcontent-%COMP%]{padding:8px 8px 0}}.table-navigation[_ngcontent-%COMP%]{display:flex;align-items:flex-start;margin:16px 0}.navigation-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-right:16px;padding-top:40px}.nav-button[_ngcontent-%COMP%]{width:32px;height:32px;border:1px solid #e6e6e6;background-color:#fff;border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;margin:4px 0;transition:all .2s ease}.nav-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f8f8f8;border-color:#d7d7d7}.nav-button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.nav-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px;color:#4a5c7b}"]})};export{k as BrowseComponent};
