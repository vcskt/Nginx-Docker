import{a as $,b as ee}from"./chunk-ZJTYN2NV.js";import{$ as u,$a as L,B as v,Ea as O,Fa as W,Fb as X,G as y,Ga as F,Gb as Y,H as f,Ha as I,Ia as x,Jb as Z,K as n,Ka as j,L as s,N as w,O as _,P as D,Ta as B,W as P,X as C,Y as S,_ as m,_a as U,aa as g,ab as H,ba as A,bb as q,ca as b,da as N,fb as z,ib as R,la as k,mb as G,nb as J,oa as T,p as l,pa as M,q as d,ra as V,sb as K,x as p,y as h,yb as Q,za as E}from"./chunk-DP6RW5WA.js";var te=()=>({label:"Aprova\xE7\xF5es",link:"/browse"}),ie=a=>({label:a}),ne=(a,i)=>[a,i],ae=a=>({items:a});function re(a,i){if(a&1&&(n(0,"po-loading"),C(1),s()),a&2){let t=D();p(),S(t.loadingText)}}var oe=class a{constructor(i,t,e,r){this.http=i;this.router=t;this.authService=e;this.poNotification=r;console.log("[AbsenceComponent] Constructor called")}pageTitle="Aus\xEAncia Tempor\xE1ria";loading=!1;loadingText="Carregando...";saving=!1;codigo="";username="";currentDate=new Date;startDate=new Date;endDate=null;reason="";apiUrl=$.apiUrl;ngOnInit(){if(console.log("[AbsenceComponent] ngOnInit called"),!this.authService.isAuthenticated()){console.warn("[AbsenceComponent] User not authenticated, redirecting to login"),this.router.navigate(["/login"]);return}this.loading=!0,this.loadUserData()}getHttpOptions(){let i=this.authService.getToken();return i?{headers:new M().set("Content-Type","application/json").set("Authorization",`Bearer ${i}`)}:(console.warn("Token n\xE3o encontrado no AuthService!"),this.poNotification.error("Sess\xE3o expirada. Por favor, fa\xE7a login novamente."),this.router.navigate(["/login"]),{headers:new M})}loadUserData(){let i=this.authService.getUsername();if(!i){this.poNotification.error("Usu\xE1rio n\xE3o identificado"),this.loading=!1;return}this.http.get(`${this.apiUrl}/rest/wssalnome/get_id?${i}`,this.getHttpOptions()).subscribe({next:t=>{try{let e;Array.isArray(t.objects)?e=t.objects[0]:t.objects?e=t.objects:typeof t=="object"&&(e=t),e?(this.codigo=e.user||"",this.username=e.desc||"",console.log("[AbsenceComponent] Dados do usu\xE1rio carregados:",e)):(console.warn("[AbsenceComponent] Nenhum dado de usu\xE1rio encontrado"),this.poNotification.warning("N\xE3o foi poss\xEDvel carregar os dados do usu\xE1rio"))}catch(e){console.error("[AbsenceComponent] Erro ao processar dados:",e),this.poNotification.error("Erro ao processar dados do usu\xE1rio")}finally{this.loading=!1}},error:t=>{console.error("[AbsenceComponent] Erro ao carregar dados do usu\xE1rio:",t),t.status===401?(this.poNotification.error("Sess\xE3o expirada. Por favor, fa\xE7a login novamente."),this.authService.logout()):this.poNotification.error("Erro ao carregar dados do usu\xE1rio"),this.loading=!1}})}onSave(){if(!this.isFormValid()){this.poNotification.error("Por favor, preencha as datas de in\xEDcio e fim.");return}this.saving=!0;let i={startDate:this.startDate,endDate:this.endDate,reason:this.reason||null,requester:this.authService.getUsername()};console.log("Dados a serem salvos:",i),setTimeout(()=>{this.saving=!1,this.poNotification.success("Solicita\xE7\xE3o de aus\xEAncia enviada com sucesso!"),this.router.navigate(["/dashboard"])},1500)}onCancel(){this.router.navigate(["/dashboard"])}isFormValid(){return!!(this.startDate&&this.endDate)}static \u0275fac=function(t){return new(t||a)(h(V),h(E),h(ee),h(z))};static \u0275cmp=v({type:a,selectors:[["app-absence"]],decls:20,vars:19,consts:[["absenceForm","ngForm"],[3,"p-title","p-breadcrumb"],[4,"ngIf"],[1,"po-row"],["name","codigo","p-label","C\xF3digo","p-readonly","true",1,"po-md-3",3,"ngModelChange","ngModel"],["name","username","p-label","Nome","p-readonly","true",1,"po-md-6",3,"ngModelChange","ngModel"],["name","currentDate","p-label","Data Atual","p-format","dd/MM/yyyy","p-readonly","true",1,"po-md-3",3,"ngModelChange","ngModel"],[1,"po-divider"],[1,"po-divider-label"],["name","startDate","p-label","Data In\xEDcio","p-placeholder","dd/mm/aaaa","p-format","dd/MM/yyyy","p-required","true",1,"po-md-3",3,"ngModelChange","ngModel"],["name","endDate","p-label","Data Fim","p-placeholder","dd/mm/aaaa","p-format","dd/MM/yyyy","p-required","true",1,"po-md-3",3,"ngModelChange","ngModel"],["name","reason","p-label","Motivo","p-placeholder","Informe o motivo da aus\xEAncia","p-required","true",1,"po-md-12",3,"ngModelChange","ngModel"],[1,"po-md-12"],["p-label","Voltar","p-kind","secondary",1,"po-md-3",3,"p-click"],["p-label","Salvar","p-kind","primary",1,"po-md-3",3,"p-click","p-loading","p-disabled"]],template:function(t,e){if(t&1){let r=w();n(0,"po-page-default",1),y(1,re,2,1,"po-loading",2),n(2,"form",null,0)(4,"div",3)(5,"po-input",4),g("ngModelChange",function(o){return l(r),u(e.codigo,o)||(e.codigo=o),d(o)}),s(),n(6,"po-input",5),g("ngModelChange",function(o){return l(r),u(e.username,o)||(e.username=o),d(o)}),s(),n(7,"po-datepicker",6),g("ngModelChange",function(o){return l(r),u(e.currentDate,o)||(e.currentDate=o),d(o)}),s()(),n(8,"div",7)(9,"span",8),C(10,"Informa\xE7\xF5es da Aus\xEAncia"),s()(),n(11,"div",3)(12,"po-datepicker",9),g("ngModelChange",function(o){return l(r),u(e.startDate,o)||(e.startDate=o),d(o)}),s(),n(13,"po-datepicker",10),g("ngModelChange",function(o){return l(r),u(e.endDate,o)||(e.endDate=o),d(o)}),s()(),n(14,"div",3)(15,"po-input",11),g("ngModelChange",function(o){return l(r),u(e.reason,o)||(e.reason=o),d(o)}),s()(),n(16,"div",3)(17,"div",12)(18,"po-button",13),_("p-click",function(){return l(r),d(e.onCancel())}),s(),n(19,"po-button",14),_("p-click",function(){return l(r),d(e.onSave())}),s()()()()()}if(t&2){let r=P(3);f("p-title",e.pageTitle)("p-breadcrumb",b(17,ae,N(14,ne,A(11,te),b(12,ie,e.pageTitle)))),p(),f("ngIf",e.loading),p(4),m("ngModel",e.codigo),p(),m("ngModel",e.username),p(),m("ngModel",e.currentDate),p(5),m("ngModel",e.startDate),p(),m("ngModel",e.endDate),p(2),m("ngModel",e.reason),p(4),f("p-loading",e.saving)("p-disabled",!r.valid)}},dependencies:[T,k,j,x,O,W,I,F,Z,H,G,K,U,X,Y,q,Q,L,J,R,B],styles:["[_nghost-%COMP%]{display:block;width:100%}[_nghost-%COMP%]     .po-page-default{margin:0;padding:8px}[_nghost-%COMP%]     .po-row{margin:4px 0;display:flex;align-items:flex-start}[_nghost-%COMP%]     .po-field-container{margin-bottom:4px}[_nghost-%COMP%]     .po-field-container .po-input-multiline{width:100%;min-height:80px;padding:8px;border:1px solid #e6e6e6;border-radius:3px;font-size:14px;line-height:1.5;resize:vertical}[_nghost-%COMP%]     .po-field-container .po-input-multiline:focus{border-color:#0c9abe;outline:none;box-shadow:0 0 0 1px #0c9abe}[_nghost-%COMP%]     .po-field-container .po-label{margin-bottom:2px}[_nghost-%COMP%]     .po-tag{margin-top:20px;height:44px;display:flex;align-items:center;justify-content:center;padding:0 16px}[_nghost-%COMP%]     .po-button{margin-right:8px}@media screen and (max-width: 768px){[_nghost-%COMP%]     .po-page-default{padding:8px}[_nghost-%COMP%]     .po-row{flex-direction:column}[_nghost-%COMP%]     .po-row .po-md-3{width:100%;margin-bottom:8px}}"]})};export{oe as AbsenceComponent};
