import{h as a,j as s,l as i,pa as l,qa as p,ra as c,za as m}from"./chunk-DP6RW5WA.js";var g={production:!1,apiUrl:"http://192.168.5.11:8400"};var d=class r{constructor(e,t){this.http=e;this.router=t;this.checkTokenValidity(),this.setupTokenCheck()}apiUrl=`${g.apiUrl}/rest/api/oauth2/v1/token`;TOKEN_KEY="auth_token";EXPIRES_KEY="token_expires_at";USERNAME_KEY="username";setupTokenCheck(){setInterval(()=>{this.checkTokenValidity()},6e4)}login(e,t){let o=new p().set("grant_type","password").set("username",e).set("password",t),u=new l().set("Content-Type","application/x-www-form-urlencoded");return this.http.post(this.apiUrl,null,{params:o,headers:u}).pipe(a(n=>{console.log("Login bem sucedido, armazenando token..."),localStorage.setItem(this.TOKEN_KEY,n.access_token);let E=new Date().getTime()+n.expires_in*1e3;localStorage.setItem(this.EXPIRES_KEY,E.toString()),localStorage.setItem(this.USERNAME_KEY,e)}))}logout(){console.log("Realizando logout..."),localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.EXPIRES_KEY),localStorage.removeItem(this.USERNAME_KEY),this.redirectToLogin()}redirectToLogin(){this.router.navigate(["/login"])}isAuthenticated(){let e=this.getToken()!==null&&!this.isTokenExpired();return console.log("Verificando autentica\xE7\xE3o:",e),e}getToken(){let e=localStorage.getItem(this.TOKEN_KEY);return e||console.warn("Token n\xE3o encontrado no localStorage"),e}getUsername(){return localStorage.getItem(this.USERNAME_KEY)}isTokenExpired(){let e=localStorage.getItem(this.EXPIRES_KEY);if(!e)return console.warn("Data de expira\xE7\xE3o do token n\xE3o encontrada"),!0;let t=30*1e3,o=new Date().getTime()>parseInt(e)-t;return o&&console.warn("Token expirado"),o}checkTokenValidity(){this.isTokenExpired()&&(console.warn("Token expirado ou inv\xE1lido. Redirecionando para login..."),this.logout())}static \u0275fac=function(t){return new(t||r)(i(c),i(m))};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};export{g as a,d as b};
